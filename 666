<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ†‹å°¿OUTï¼Œè¢…è¢…ON - å„¿ç«¥å¥åº·æ´»åŠ¨</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=VT323&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind Configuration -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'pop-yellow': '#FFEA00',
              'pop-pink': '#FF4D8C',
              'pop-red': '#FF2E2E',
              'pop-blue': '#4DE1FF',
              'pop-green': '#39FF14',
              'pop-orange': '#FF8C00',
              'pop-purple': '#9D4DFF',
            },
            fontFamily: {
              'sans': ['"ZCOOL KuaiLe"', 'sans-serif'],
              'pixel': ['"VT323"', 'monospace'],
            },
            boxShadow: {
              'pixel': '4px 4px 0px 0px rgba(0,0,0,0.2)',
              'pixel-lg': '8px 8px 0px 0px rgba(0,0,0,0.2)',
              'hard': '4px 4px 0px 0px #000000',
              'hard-xl': '8px 8px 0px 0px #000000',
              'soft': '0 8px 20px rgba(0,0,0,0.1)',
            },
            animation: {
              'float': 'float 4s ease-in-out infinite',
              'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite',
              'spin-slow': 'spin 60s linear infinite',
              'spin-medium': 'spin 10s linear infinite',
              'lightning': 'lightning 2s infinite',
              'steam': 'steam 2s infinite',
              'alarm': 'alarm 0.5s infinite',
            },
            keyframes: {
              float: {
                '0%, 100%': { transform: 'translateY(0)' },
                '50%': { transform: 'translateY(-10px)' },
              },
              shake: {
                '0%, 100%': { transform: 'translateX(0)' },
                '25%': { transform: 'translateX(-5px) rotate(-1deg)' },
                '75%': { transform: 'translateX(5px) rotate(1deg)' },
              },
              lightning: {
                '0%, 100%': { opacity: 0, transform: 'translateY(-10px) scale(0.8)' },
                '10%, 30%': { opacity: 1, transform: 'translateY(0) scale(1)' },
                '40%': { opacity: 0, transform: 'translateY(0) scale(1)' },
              },
              steam: {
                '0%': { opacity: 0, transform: 'translateY(0) scale(0.5)' },
                '50%': { opacity: 0.6, transform: 'translateY(-10px) scale(1)' },
                '100%': { opacity: 0, transform: 'translateY(-20px) scale(1.5)' },
              },
              alarm: {
                '0%, 100%': { transform: 'rotate(0deg)' },
                '25%': { transform: 'rotate(-15deg)' },
                '75%': { transform: 'rotate(15deg)' },
              }
            }
          }
        }
      }
    </script>

    <!-- Global Styles -->
    <style>
      body {
        background-color: #FFF9C4; /* Soft Pale Yellow */
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 12px;
      }
      ::-webkit-scrollbar-track {
        background: #FFF;
      }
      ::-webkit-scrollbar-thumb {
        background: #FF4D8C;
        border-radius: 6px;
      }
      .text-stroke-2 {
        -webkit-text-stroke: 2px black;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
    
    <!-- Import Map for Modules -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0",
    "canvas-confetti": "https://esm.sh/canvas-confetti@1.9.2",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel" data-presets="react,typescript" data-type="module">
      import React, { useState, useEffect, useRef, useCallback } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        Menu, X, Heart, ArrowDown, BookOpen, AlertCircle, 
        Coffee, Clock, Upload, Play, RotateCcw, 
        AlertTriangle, Droplets, Sparkles, Pin, Activity, Ban,
        ArrowRight, ArrowLeft, ArrowUp, Zap, CloudFog, XCircle,
        CheckCircle, AlertOctagon, Skull
      } from 'lucide-react';
      import confetti from 'canvas-confetti';

      // --- 1. TYPES & DATA ---
      
      const NAV_ITEMS = [
        { label: 'é¦–é¡µ', href: '#hero' },
        { label: 'çœ‹è§†é¢‘', href: '#video' },
        { label: 'ç§‘æ™®æµ·æŠ¥', href: '#poster' },
        { label: 'å¤§å†’é™©', href: '#game' },
        { label: 'å¥åº·çŸ¥è¯†', href: '#info' },
      ];

      const HEALTH_TIPS = [
        {
          id: 1,
          title: 'ä¸è¦æ†‹å°¿',
          description: 'æƒ³å°¿å°¿çš„æ—¶å€™è¦é©¬ä¸Šå‘Šè¯‰è€å¸ˆæˆ–å®¶é•¿ï¼Œæ†‹å°¿ä¼šè®©èº«ä½“ç”Ÿç—…å“¦ï¼',
          iconName: 'AlertTriangle'
        },
        {
          id: 2,
          title: 'å¤šå–æ°´',
          description: 'æ¯å¤©è¦å–è¶³å¤Ÿçš„æ°´ï¼Œå¸®åŠ©èº«ä½“æ’æ¯’ï¼Œè®©è¢…è¢…å¼€å¿ƒï¼',
          iconName: 'Droplets'
        },
        {
          id: 3,
          title: 'å‹¤æ´—æ‰‹',
          description: 'ä¸Šå®Œå•æ‰€è¦æ´—æ‰‹ï¼Œç»†èŒæ‹œæ‹œï¼Œå¥åº·æ¥ï¼',
          iconName: 'Sparkles'
        }
      ];

      const LEVELS = [
        {
          id: 1,
          name: "ç¬¬ä¸€å…³ï¼šæ•™å®¤æ¢é™©",
          gridSize: 5,
          timeLimit: 30,
          bgStyle: {
              backgroundColor: '#FFEDD5', 
              backgroundImage: 'repeating-linear-gradient(45deg, #FDBA74 0, #FDBA74 1px, transparent 0, transparent 50%)',
              backgroundSize: '10px 10px',
              opacity: 0.9
          },
          wallIcon: "ğŸª‘", 
          tip: "ä¸‹è¯¾é“ƒå“äº†ï¼Œè¦ç«‹åˆ»å»å•æ‰€ï¼Œä¸è¦å› ä¸ºè´ªç©è€Œæ†‹å°¿å“¦ï¼",
          layout: [
            ['start', 'empty', 'wall', 'empty', 'empty'],
            ['wall', 'empty', 'coffee', 'empty', 'wall'],
            ['empty', 'empty', 'empty', 'empty', 'empty'],
            ['empty', 'wall', 'wall', 'wall', 'empty'],
            ['empty', 'coffee', 'empty', 'wall', 'toilet'],
          ]
        },
        {
          id: 2,
          name: "ç¬¬äºŒå…³ï¼šçƒ­é—¹å•†åœº",
          gridSize: 5,
          timeLimit: 25,
          bgStyle: {
              backgroundColor: '#DBEAFE', 
              backgroundImage: 'linear-gradient(45deg, #93C5FD 25%, transparent 25%, transparent 75%, #93C5FD 75%, #93C5FD), linear-gradient(45deg, #93C5FD 25%, transparent 25%, transparent 75%, #93C5FD 75%, #93C5FD)',
              backgroundSize: '20px 20px',
              backgroundPosition: '0 0, 10px 10px'
          },
          wallIcon: "ğŸ›ï¸", 
          tip: "é€›è¡—æ—¶å¦‚æœæƒ³å°¿å°¿ï¼Œè¦é©¬ä¸Šå‘Šè¯‰çˆ¸çˆ¸å¦ˆå¦ˆï¼Œæ‰¾å•†åœºé‡Œçš„å•æ‰€æ ‡å¿—ï¼",
          layout: [
            ['start', 'tea', 'empty', 'wall', 'empty'],
            ['empty', 'wall', 'empty', 'empty', 'empty'],
            ['empty', 'empty', 'empty', 'tea', 'empty'],
            ['empty', 'empty', 'wall', 'wall', 'dirty_toilet'],
            ['wall', 'empty', 'empty', 'empty', 'toilet'],
          ]
        },
        {
          id: 3,
          name: "ç¬¬ä¸‰å…³ï¼šå…¬å›­è¿·å®«",
          gridSize: 5,
          timeLimit: 20,
          bgStyle: {
              backgroundColor: '#DCFCE7', 
              backgroundImage: 'radial-gradient(#86EFAC 20%, transparent 20%), radial-gradient(#86EFAC 20%, transparent 20%)',
              backgroundSize: '16px 16px',
              backgroundPosition: '0 0, 8px 8px'
          },
          wallIcon: "ğŸŒ³", 
          tip: "åœ¨å¤–é¢ç©è€æ—¶ï¼Œä¸è¦ç­‰åˆ°æ†‹ä¸ä½äº†æ‰æ‰¾å•æ‰€ï¼Œè†€èƒ±ä¼šå—ä¼¤çš„ï¼",
          layout: [
            ['start', 'empty', 'empty', 'empty', 'empty'],
            ['tea', 'empty', 'empty', 'wall', 'empty'],
            ['wall', 'wall', 'wall', 'wall', 'dirty_toilet'],
            ['empty', 'empty', 'empty', 'empty', 'empty'], 
            ['toilet', 'wall', 'wall', 'wall', 'empty'],
          ]
        }
      ];

      const VIDEO_PLACEHOLDER_URL = "https://picsum.photos/seed/niao/800/450";

      // --- 2. COMPONENTS ---

      // --- BlobBackground ---
      const BlobBackground = () => {
        return (
          <div className="absolute inset-0 overflow-hidden pointer-events-none -z-10 bg-[#FFF9C4]">
            {/* Top Left - Large Soft Oval */}
            <div 
              className="absolute -top-[10%] -left-[10%] w-[50%] h-[50%] bg-[#FFF176] opacity-30" 
              style={{ borderRadius: '40% 60% 70% 30% / 40% 50% 60% 50%' }}
            ></div>
            {/* Top Right - Medium Gold Blob */}
            <div 
              className="absolute top-[5%] right-[10%] w-[25%] h-[30%] bg-[#FFEE58] opacity-20 transform rotate-12"
              style={{ borderRadius: '60% 40% 30% 70% / 60% 30% 70% 40%' }}
            ></div>
            {/* Center Left - Small Light Blob */}
            <div 
              className="absolute top-[40%] left-[5%] w-[15%] h-[20%] bg-[#FFF59D] opacity-40 transform -rotate-6"
              style={{ borderRadius: '50% 50% 40% 60% / 50% 50% 60% 40%' }}
            ></div>
            {/* Center Right - Large Irregular Shape */}
            <div 
              className="absolute top-[30%] right-[0%] w-[35%] h-[40%] bg-[#FFF176] opacity-25"
              style={{ borderRadius: '30% 70% 70% 30% / 30% 30% 70% 70%' }}
            ></div>
            {/* Bottom Left - Pale Gold Bean */}
            <div 
              className="absolute bottom-[5%] left-[15%] w-[30%] h-[25%] bg-[#FFEE58] opacity-20 transform -rotate-12"
              style={{ borderRadius: '70% 30% 30% 70% / 60% 40% 60% 40%' }}
            ></div>
            {/* Bottom Right - Corner Blob */}
            <div 
              className="absolute -bottom-[10%] -right-[5%] w-[40%] h-[40%] bg-[#FFF59D] opacity-40"
              style={{ borderRadius: '40% 60% 60% 40% / 40% 60% 60% 40%' }}
            ></div>
          </div>
        );
      };

      // --- SoftMascot ---
      const SoftMascot = ({ className = "w-full h-full", expression = 'happy', opacity = 1 }) => {
        // Helper to render a single bladder face
        const renderFace = (expr, cx = 100, cy = 80, scale = 1) => {
            const eyeOffset = 25 * scale;
            const eyeRadius = 6 * scale;
            const cheekOffset = 45 * scale;
            const cheekY = 10 * scale;
            const cheekRx = 8 * scale;
            const cheekRy = 5 * scale;
            
            return (
            <g>
                {/* Eyes logic based on expression */}
                {expr === 'wink' ? (
                <>
                    {/* Left Eye: Curve */}
                    <path d={`M${cx - eyeOffset - 8*scale} ${cy} Q ${cx - eyeOffset} ${cy - 8*scale} ${cx - eyeOffset + 8*scale} ${cy}`} stroke="#000" strokeWidth={3 * scale} strokeLinecap="round" fill="none" />
                    {/* Right Eye: Circle */}
                    <circle cx={cx + eyeOffset} cy={cy} r={eyeRadius} fill="#000" />
                </>
                ) : (
                <>
                    <circle cx={cx - eyeOffset} cy={cy} r={eyeRadius} fill="#000" />
                    <circle cx={cx + eyeOffset} cy={cy} r={eyeRadius} fill="#000" />
                </>
                )}
                
                {/* Cheeks */}
                <ellipse cx={cx - cheekOffset} cy={cy + cheekY} rx={cheekRx} ry={cheekRy} fill="#FF69B4" opacity="0.6" />
                <ellipse cx={cx + cheekOffset} cy={cy + cheekY} rx={cheekRx} ry={cheekRy} fill="#FF69B4" opacity="0.6" />
                
                {/* Mouths */}
                {(expr === 'happy' || expr === 'wink') && <path d={`M${cx - 10*scale} ${cy + 15*scale} Q ${cx} ${cy + 25*scale} ${cx + 10*scale} ${cy + 15*scale}`} stroke="#000" strokeWidth={3 * scale} strokeLinecap="round" fill="none" />}
                
                {expr === 'worry' && <path d={`M${cx - 10*scale} ${cy + 20*scale} Q ${cx} ${cy + 10*scale} ${cx + 10*scale} ${cy + 20*scale}`} stroke="#000" strokeWidth={3 * scale} strokeLinecap="round" fill="none" />}
                
                {expr === 'relief' && <path d={`M${cx - 10*scale} ${cy + 15*scale} Q ${cx} ${cy + 30*scale} ${cx + 10*scale} ${cy + 15*scale}`} stroke="#000" strokeWidth={3 * scale} strokeLinecap="round" fill="none" />}
                
                {expr === 'shocked' && <circle cx={cx} cy={cy + 18*scale} r={8 * scale} fill="#000" />}
                
                {expr === 'screaming' && <ellipse cx={cx} cy={cy + 25*scale} rx={12 * scale} ry={18 * scale} fill="#000" />}
                
                {expr === 'glasses' && (
                <g>
                    <circle cx={cx - eyeOffset} cy={cy} r={12 * scale} stroke="#333" strokeWidth={2 * scale} fill="rgba(255,255,255,0.3)" />
                    <circle cx={cx + eyeOffset} cy={cy} r={12 * scale} stroke="#333" strokeWidth={2 * scale} fill="rgba(255,255,255,0.3)" />
                    <line x1={cx - 13*scale} y1={cy} x2={cx + 13*scale} y2={cy} stroke="#333" strokeWidth={2 * scale} />
                    <path d={`M${cx - 8*scale} ${cy + 20*scale} Q ${cx} ${cy + 15*scale} ${cx + 8*scale} ${cy + 20*scale}`} stroke="#000" strokeWidth={2 * scale} strokeLinecap="round" fill="none" />
                </g>
                )}
            </g>
            );
        };

        const renderBody = (cx = 100, cy = 100, scale = 1) => {
            return (
                <g transform={`translate(${cx}, ${cy}) scale(${scale}) translate(-100, -100)`}>
                    <path d="M40 80 Q 20 50 40 40" stroke="#FFB6C1" strokeWidth="12" strokeLinecap="round" fill="none" />
                    <path d="M160 80 Q 180 50 160 40" stroke="#FFB6C1" strokeWidth="12" strokeLinecap="round" fill="none" />
                    <path d="M80 150 Q 70 180 60 180" stroke="#FFF0F5" strokeWidth="12" strokeLinecap="round" fill="none" />
                    <path d="M120 150 Q 130 180 140 180" stroke="#FFF0F5" strokeWidth="12" strokeLinecap="round" fill="none" />
                    <path d="M100 170 C 60 170, 30 140, 30 90 C 30 40, 60 20, 100 20 C 140 20, 170 40, 170 90 C 170 140, 140 170, 100 170 Z" fill="#FFC0CB" />
                    <path d="M100 165 C 65 165, 35 135, 35 90 C 35 45, 65 25, 100 25 C 135 25, 165 45, 165 90 C 165 135, 135 165, 100 165 Z" fill="url(#blushGradient)" opacity="0.5"/>
                </g>
            )
        };

        return (
            <svg viewBox="0 0 200 200" className={className} xmlns="http://www.w3.org/2000/svg" style={{ opacity }}>
            <defs>
                <filter id="watercolor" x="-20%" y="-20%" width="140%" height="140%">
                <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo" />
                <feComposite in="SourceGraphic" in2="goo" operator="atop"/>
                </filter>
                <radialGradient id="blushGradient">
                <stop offset="0%" stopColor="#FFB6C1" stopOpacity="0.8" />
                <stop offset="100%" stopColor="#FFB6C1" stopOpacity="0" />
                </radialGradient>
            </defs>
            
            <g filter="url(#watercolor)">
                {expression === 'duo' ? (
                    <>
                        {renderBody(120, 90, 0.9)}
                        {renderBody(60, 130, 0.5)}
                    </>
                ) : (
                    renderBody(100, 100, 1)
                )}
            </g>
            
            <g>
                {expression === 'duo' ? (
                    <>
                        {renderFace('happy', 120, 72, 0.9)}
                        {renderFace('happy', 60, 120, 0.5)}
                    </>
                ) : (
                    renderFace(expression, 100, 80, 1)
                )}
            </g>
            </svg>
        );
      };

      // --- Navbar ---
      const Navbar = () => {
        const [isOpen, setIsOpen] = useState(false);
        return (
          <nav className="fixed top-4 left-0 w-full z-50 px-4 pointer-events-none">
            <div className="container mx-auto flex justify-center pointer-events-auto">
              <div className="bg-white/90 backdrop-blur-sm rounded-full px-6 py-3 shadow-soft flex items-center justify-between gap-8 md:gap-12 border-2 border-white">
                  <a href="#" className="flex items-center gap-2 group">
                      <div className="bg-pop-pink rounded-full p-1.5 animate-pulse">
                          <Heart className="text-white fill-current" size={20} />
                      </div>
                      <span className="font-black text-xl tracking-tight text-pop-pink">æ†‹å°¿OUT</span>
                  </a>
                  <div className="hidden md:flex gap-1">
                      {NAV_ITEMS.map((item) => (
                          <a key={item.label} href={item.href} className="text-gray-600 hover:text-pop-pink hover:bg-pink-50 font-bold px-4 py-1.5 rounded-full transition-all text-sm">
                              {item.label}
                          </a>
                      ))}
                  </div>
                  <div className="hidden md:flex">
                      <a href="#game" className="bg-pop-pink text-white text-xs font-black px-3 py-1.5 rounded-full hover:scale-105 transition-transform">START</a>
                  </div>
                  <button className="md:hidden bg-pop-pink text-white p-1.5 rounded-full" onClick={() => setIsOpen(!isOpen)}>
                      {isOpen ? <X size={20} /> : <Menu size={20} />}
                  </button>
              </div>
            </div>
            {isOpen && (
              <div className="md:hidden absolute top-20 left-4 right-4 bg-white rounded-3xl shadow-xl p-6 flex flex-col gap-4 pointer-events-auto border-4 border-pop-pink">
                  {NAV_ITEMS.map((item) => (
                      <a key={item.label} href={item.href} onClick={() => setIsOpen(false)} className="text-center font-black text-xl text-gray-800 hover:text-pop-pink py-2">
                        {item.label}
                      </a>
                  ))}
              </div>
            )}
          </nav>
        );
      };

      // --- Hero ---
      const bgMascots = [
        { top: '5%', left: '2%', size: 'w-32', rotate: '-12deg', expression: 'happy', delay: '0s', opacity: 0.9, duration: '6s' },
        { top: '8%', right: '5%', size: 'w-40', rotate: '12deg', expression: 'wink', delay: '1.5s', opacity: 0.85, duration: '7s' },
        { bottom: '10%', left: '5%', size: 'w-36', rotate: '-6deg', expression: 'happy', delay: '2s', opacity: 0.8, duration: '6.5s' },
        { bottom: '15%', right: '8%', size: 'w-40', rotate: '-10deg', expression: 'glasses', delay: '2.5s', opacity: 0.9, duration: '6.8s' },
        { top: '25%', left: '15%', size: 'w-24', rotate: '-180deg', expression: 'wink', delay: '3s', opacity: 0.7, duration: '8s' },
        { top: '35%', right: '12%', size: 'w-28', rotate: '45deg', expression: 'glasses', delay: '0.5s', opacity: 0.8, duration: '5s' },
        { bottom: '25%', left: '20%', size: 'w-24', rotate: '15deg', expression: 'worry', delay: '1s', opacity: 0.7, duration: '5.5s' },
        { top: '45%', left: '8%', size: 'w-20', rotate: '20deg', expression: 'wink', delay: '4s', opacity: 0.6, duration: '7.5s' },
        { top: '15%', right: '25%', size: 'w-16', rotate: '-30deg', expression: 'worry', delay: '2s', opacity: 0.5, duration: '6s' },
        { bottom: '40%', right: '2%', size: 'w-28', rotate: '10deg', expression: 'happy', delay: '1s', opacity: 0.8, duration: '8s' },
        { bottom: '5%', left: '40%', size: 'w-32', rotate: '-5deg', expression: 'wink', delay: '3s', opacity: 0.7, duration: '7s' },
        { top: '2%', left: '35%', size: 'w-20', rotate: '180deg', expression: 'happy', delay: '5s', opacity: 0.5, duration: '9s' },
        { top: '55%', right: '20%', size: 'w-22', rotate: '-15deg', expression: 'glasses', delay: '0.8s', opacity: 0.8, duration: '6.2s' },
        { top: '60%', left: '2%', size: 'w-16', rotate: '45deg', expression: 'wink', delay: '1.2s', opacity: 0.4, duration: '8.5s' },
        { top: '10%', left: '50%', size: 'w-14', rotate: '-15deg', expression: 'relief', delay: '2.3s', opacity: 0.5, duration: '7.2s' },
        { bottom: '20%', right: '35%', size: 'w-18', rotate: '90deg', expression: 'worry', delay: '0.5s', opacity: 0.4, duration: '6.8s' },
        { top: '80%', right: '15%', size: 'w-12', rotate: '-45deg', expression: 'happy', delay: '3.1s', opacity: 0.6, duration: '5.5s' },
        { bottom: '35%', left: '30%', size: 'w-20', rotate: '180deg', expression: 'glasses', delay: '1.8s', opacity: 0.5, duration: '7.8s' },
      ];

      const Hero = () => {
        return (
          <section id="hero" className="relative min-h-screen flex flex-col justify-center items-center overflow-hidden pt-10">
            <BlobBackground />
            <div className="absolute inset-0 pointer-events-none z-0">
                {bgMascots.map((config, index) => (
                  <div key={index} className={`absolute animate-float`} style={{
                      top: config.top, bottom: config.bottom, left: config.left, right: config.right,
                      animationDelay: config.delay, animationDuration: config.duration,
                    }}>
                    <div className={`${config.size} transform hover:scale-110 transition-transform duration-300`} style={{ transform: `rotate(${config.rotate})` }}>
                      <SoftMascot expression={config.expression} opacity={config.opacity} /> 
                    </div>
                  </div>
                ))}
            </div>

            <div className="container mx-auto px-4 relative z-10 flex flex-col items-center text-center">
              <div className="mb-4 relative flex flex-col items-center gap-2 z-20">
                  <div className="relative group">
                     <h1 className="text-8xl md:text-[10rem] font-normal tracking-wide text-white drop-shadow-[8px_8px_0_#FF4D8C] leading-none select-none hover:scale-105 transition-transform duration-300">
                        æ†‹å°¿ <span className="inline-block text-pop-pink ml-4 animate-bounce" style={{ animationDuration: '2s' }}>OUT</span>
                     </h1>
                  </div>
                  <div className="relative group -mt-4">
                    <h1 className="text-8xl md:text-[10rem] font-normal tracking-wide text-white drop-shadow-[8px_8px_0_#4DE1FF] leading-none select-none hover:scale-105 transition-transform duration-300">
                        è¢…è¢… <span className="inline-block text-pop-blue ml-4 animate-pulse" style={{ animationDuration: '1.5s' }}>ON</span>
                     </h1>
                  </div>
              </div>

              <div className="relative w-80 h-80 md:w-96 md:h-96 my-4 z-10">
                   <div className="w-full h-full bg-white rounded-full border-[12px] border-pop-pink shadow-hard-xl relative">
                      {[...Array(12)].map((_, i) => (
                        <div key={i} className="absolute inset-0" style={{ transform: `rotate(${i * 30}deg)` }}>
                          <div className="w-3 h-8 md:w-4 md:h-10 bg-pop-pink mx-auto mt-4 rounded-full" />
                        </div>
                      ))}
                      <div className="absolute top-1/2 left-1/2 w-8 h-8 bg-black rounded-full z-30 transform -translate-x-1/2 -translate-y-1/2"></div>
                      <div className="absolute w-4 h-24 bg-black rounded-full z-20 origin-bottom" style={{ left: 'calc(50% - 8px)', bottom: '50%', transform: 'rotate(45deg)' }}></div>
                      <div className="absolute w-2 h-36 z-20 origin-bottom" style={{ left: 'calc(50% - 4px)', bottom: '50%', animation: 'spin 60s linear infinite' }}>
                        <div className="w-full h-full bg-black rounded-full"></div>
                        <div className="absolute -top-12 -left-8 w-20 h-20 animate-bounce" style={{ animationDuration: '1s' }}><SoftMascot expression="happy" /></div>
                      </div>
                      <div className="absolute w-1 h-40 bg-pop-red rounded-full z-20 origin-bottom" style={{ left: 'calc(50% - 2px)', bottom: '50%', animation: 'spin 10s linear infinite' }}></div>
                   </div>
              </div>

              <div className="relative z-20 mt-8 flex flex-col items-center gap-4">
                 <div className="bg-pop-yellow text-black px-5 py-2 rounded-full font-normal text-xl border-2 border-black shadow-hard transform -rotate-2 tracking-wide">
                    ğŸ‘§ å…³æ³¨ 6-18 å²å¥³å­©å¥åº·
                 </div>
                 <p className="font-normal text-2xl text-white bg-black/80 px-6 py-3 rounded-full shadow-pixel transform rotate-1 hover:rotate-0 transition-all border-2 border-white">
                   âœ¨ æ‘†è„±æ†‹å°¿ï¼Œè·Ÿè¢…è¢…ä¸€èµ·äº«å—å¥åº·ï¼ âœ¨
                </p>
              </div>

              <div className="flex flex-col sm:flex-row gap-6 mt-12 mb-12 z-20">
                  <a href="#video" className="bg-white text-pop-pink border-4 border-pop-pink px-10 py-4 rounded-full text-2xl font-normal shadow-pixel hover:shadow-none hover:translate-y-1 transition-all">è§‚çœ‹è§†é¢‘</a>
                  <a href="#game" className="bg-pop-pink text-white border-4 border-pop-pink px-10 py-4 rounded-full text-2xl font-normal shadow-pixel hover:shadow-none hover:translate-y-1 transition-all">å¼€å§‹æ¸¸æˆ</a>
              </div>

              <div className="absolute bottom-4 animate-bounce z-20"><ArrowDown className="text-black" size={32} strokeWidth={3} /></div>
            </div>
          </section>
        );
      };

      // --- VideoSection ---
      const VideoSection = () => {
        const [videoSrc, setVideoSrc] = useState('./video.mp4');
        const [hasError, setHasError] = useState(false);
        const videoRef = useRef(null);
        const fileInputRef = useRef(null);

        const handleFileChange = (event) => {
          const file = event.target.files?.[0];
          if (file) {
            setVideoSrc(URL.createObjectURL(file));
            setHasError(false);
            setTimeout(() => videoRef.current?.play().catch(console.log), 100);
          }
        };

        return (
          <section id="video" className="py-20 bg-pop-yellow relative">
            <div className="container mx-auto px-4">
              <div className="flex flex-col items-center mb-16">
                <div className="bg-black text-pop-yellow font-pixel text-xl px-4 py-2 mb-2 rotate-2">EPISODE.01</div>
                <h2 className="text-5xl md:text-7xl font-normal text-center text-white drop-shadow-[4px_4px_0_#FF4D8C] transform -rotate-1 max-w-4xl leading-tight">WHY NOT HOLDING URINE?</h2>
                <p className="mt-6 text-xl text-black font-normal bg-white px-6 py-2 border-2 border-black shadow-hard rotate-1 rounded-full">ä¸ºä»€ä¹ˆä¸èƒ½æ†‹å°¿ï¼Ÿå¬å¬è¢…è¢…æ€ä¹ˆè¯´ï¼</p>
              </div>

              <div className="max-w-4xl mx-auto mb-20 relative group">
                <div className="absolute inset-0 bg-black translate-x-4 translate-y-4 rounded-xl"></div>
                <div className="relative bg-pop-pink border-4 border-black p-4 md:p-8 rounded-xl">
                  <div className="aspect-video bg-black border-4 border-black relative overflow-hidden rounded-lg">
                    {!hasError ? (
                      <video 
                          ref={videoRef} 
                          className="w-full h-full object-contain" 
                          controls 
                          src={videoSrc} 
                          poster={VIDEO_PLACEHOLDER_URL} 
                          onError={() => setHasError(true)}
                      >
                          æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ã€‚
                      </video>
                    ) : (
                      <div className="text-white h-full flex flex-col items-center justify-center p-8 text-center bg-gray-900">
                        <AlertCircle size={48} className="text-pop-yellow mb-4 animate-bounce" />
                        <p className="text-2xl font-normal mb-2 font-pixel">VIDEO NOT FOUND</p>
                        <p className="text-sm mb-6 max-w-md">æ— æ³•åŠ è½½è§†é¢‘ã€‚è¯·ç¡®ä¿ "video.mp4" åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ–æ‰‹åŠ¨é€‰æ‹©è§†é¢‘æ–‡ä»¶ã€‚</p>
                        <button onClick={() => fileInputRef.current?.click()} className="mt-6 bg-pop-yellow text-black px-6 py-3 border-4 border-black shadow-hard hover:shadow-none hover:translate-x-1 hover:translate-y-1 font-normal flex items-center gap-2 rounded-lg">
                          <Upload size={20} /> é€‰æ‹©æœ¬åœ°è§†é¢‘
                        </button>
                      </div>
                    )}
                  </div>
                  <div className="mt-4 flex justify-between items-center border-t-4 border-black/20 pt-4 px-2"><div className="font-pixel text-xl text-white">REC â—</div></div>
                </div>
              </div>
              <input ref={fileInputRef} type="file" accept="video/*" className="hidden" onChange={handleFileChange} />
              <div className="max-w-6xl mx-auto">
                <div className="flex items-center gap-4 mb-10"><BookOpen size={40} className="text-black" strokeWidth={3} /><h3 className="text-4xl font-normal italic">NIAO'S NOTES</h3><div className="flex-1 h-2 bg-black rounded-full"></div></div>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                    {/* Risk Card */}
                    <div className="bg-white p-6 border-4 border-black shadow-hard rounded-xl hover:-translate-y-2 transition-transform relative overflow-hidden">
                      <div className="bg-pop-orange w-16 h-16 border-4 border-black flex items-center justify-center text-3xl mb-4 shadow-hard text-white rounded-full relative z-10">
                          !
                          <div className="absolute -top-8 left-1/2 -translate-x-1/2 text-pop-yellow animate-lightning">
                              <Zap size={40} fill="currentColor" strokeWidth={3} className="stroke-black" />
                          </div>
                      </div>
                      <h4 className="text-2xl font-normal mb-2 uppercase">29.2% Risk</h4>
                      <p className="text-lg text-gray-800 leading-snug">ç ”ç©¶è¡¨æ˜ï¼Œæœ‰æ†‹å°¿ä¹ æƒ¯çš„å¥³ç”Ÿï¼Œå°¿è·¯æ„ŸæŸ“çš„é£é™©é«˜è¾¾ 29.2%ï¼</p>
                    </div>

                    {/* Coffee Card */}
                    <div className="bg-white p-6 border-4 border-black shadow-hard rounded-xl hover:-translate-y-2 transition-transform">
                      <div className="relative w-16 h-16 mb-4">
                           <div className="bg-pop-pink w-full h-full border-4 border-black flex items-center justify-center text-3xl shadow-hard text-white rounded-full relative z-10">
                              <Coffee size={32} strokeWidth={3} />
                           </div>
                           <div className="absolute -top-6 left-1/4 text-gray-400 animate-steam" style={{ animationDelay: '0s' }}>
                              <CloudFog size={20} />
                           </div>
                           <div className="absolute -top-8 left-1/2 text-gray-400 animate-steam" style={{ animationDelay: '0.5s' }}>
                              <CloudFog size={24} />
                           </div>
                      </div>
                      <h4 className="text-2xl font-normal mb-2 uppercase">NO COFFEE</h4>
                      <p className="text-lg text-gray-800 leading-snug">å’–å•¡å’Œå¥¶èŒ¶ä¼šåˆºæ¿€è‚¾è„åŠ é€Ÿäº§å°¿ã€‚å°‘å–ä¸€ç‚¹ï¼Œå¯¹è¢…è¢…å¥½ä¸€ç‚¹ï¼</p>
                    </div>

                    {/* Clock Card */}
                    <div className="bg-white p-6 border-4 border-black shadow-hard rounded-xl hover:-translate-y-2 transition-transform">
                      <div className="bg-pop-purple w-16 h-16 border-4 border-black flex items-center justify-center text-3xl mb-4 shadow-hard text-white rounded-full animate-alarm origin-bottom">
                          <Clock size={32} strokeWidth={3} />
                      </div>
                      <h4 className="text-2xl font-normal mb-2 uppercase">1-2 HOURS</h4>
                      <p className="text-lg text-gray-800 leading-snug">å¦‚æœåœ¨ç‰¹æ®Šæƒ…å†µå¿…é¡»æ†‹å°¿ï¼Œè¯·å°½é‡æ§åˆ¶åœ¨ 1-2 å°æ—¶å†…å“¦ã€‚</p>
                    </div>
                </div>
              </div>
            </div>
          </section>
        );
      };

      // --- PosterSection ---
      const posterBgMascots = [
        { top: '10%', left: '5%', size: 'w-24', rotate: '-15deg', expression: 'worry', delay: '0s', opacity: 0.5 },
        { bottom: '15%', right: '5%', size: 'w-32', rotate: '10deg', expression: 'happy', delay: '1s', opacity: 0.5 },
        { top: '40%', right: '10%', size: 'w-20', rotate: '20deg', expression: 'glasses', delay: '2s', opacity: 0.4 },
        { bottom: '10%', left: '10%', size: 'w-28', rotate: '-5deg', expression: 'relief', delay: '1.5s', opacity: 0.5 },
      ];

      const PosterSection = () => {
        return (
          <section id="poster" className="py-24 relative overflow-hidden bg-pop-pink">
              <div className="absolute inset-0 pointer-events-none overflow-hidden">
                   {posterBgMascots.map((config, index) => (
                      <div key={index} className={`absolute animate-float`} style={{ top: config.top, bottom: config.bottom, left: config.left, right: config.right, animationDelay: config.delay }}>
                        <div className={`${config.size} transform`} style={{ transform: `rotate(${config.rotate})` }}><SoftMascot expression={config.expression} opacity={config.opacity} /></div>
                      </div>
                    ))}
              </div>
              <div className="container mx-auto px-4 relative z-10">
                  <div className="text-center mb-16">
                    <h2 className="text-5xl md:text-8xl font-normal text-white drop-shadow-[6px_6px_0_#000000] uppercase">Misinformation</h2>
                    <div className="inline-block bg-white text-black px-4 py-1 mt-4 text-xl font-bold border-2 border-black shadow-hard rotate-1">
                      èµ°å‡ºè¯¯åŒºï¼Œç§‘å­¦æ’å°¿
                    </div>
                  </div>

                  <div className="flex flex-col md:flex-row justify-center gap-12 md:gap-16 items-start max-w-7xl mx-auto">
                      {/* Poster 1: Myth - Live people won't die from holding pee */}
                      <div className="relative group max-w-xl w-full">
                          <div className="absolute -top-6 left-1/2 -translate-x-1/2 z-20 w-32 h-8 bg-white/50 rotate-2 backdrop-blur-sm border-2 border-white/20 shadow-sm"></div>
                          <div className="absolute -top-8 left-1/2 -translate-x-1/2 z-30"><Pin className="text-pop-red fill-pop-red drop-shadow-md" size={40} /></div>
                          <div className="bg-white p-2 border-4 border-black shadow-hard-xl rotate-[-2deg] group-hover:rotate-0 group-hover:scale-105 transition-all duration-300">
                              <div className="bg-pop-yellow p-6 md:p-8 min-h-[500px] flex flex-col items-center text-center border-2 border-black relative overflow-hidden">
                                   <div className="absolute top-0 right-0 w-32 h-32 bg-white/30 rounded-full -mr-10 -mt-10 pointer-events-none"></div>
                                   
                                   {/* Badge */}
                                   <div className="absolute top-2 right-2 bg-black text-white text-sm font-bold px-3 py-1 rotate-12 z-10">MYTH #01</div>

                                   <div className="bg-white rounded-full p-6 mb-4 shadow-hard border-4 border-black relative z-10">
                                     <Ban size={64} className="text-pop-red" strokeWidth={3} />
                                   </div>
                                   
                                   <h3 className="text-4xl font-black text-black mb-6 leading-tight bg-white px-4 py-2 rotate-1 inline-block border-2 border-black shadow-sm">
                                     æ´»äººä¸ä¼šè¢«å°¿æ†‹æ­»?
                                   </h3>
                                   
                                   <div className="bg-white p-6 rounded-xl border-2 border-black w-full flex-1 flex flex-col gap-5 text-left shadow-soft relative">
                                      {/* Tape */}
                                      <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-20 h-5 bg-red-200/80 rotate-2 border border-red-300/50"></div>

                                      <div className="flex items-start gap-4 border-b-2 border-dashed border-gray-200 pb-4">
                                        <XCircle className="text-gray-400 shrink-0 mt-1" size={24} />
                                        <div>
                                          <p className="font-bold text-gray-500 text-sm uppercase mb-1">Common Belief</p>
                                          <p className="text-gray-500 line-through decoration-2 decoration-red-500 font-medium text-xl">
                                            "æ”¾å¿ƒæ†‹å§ï¼Œä»æ¥æ²¡å¬è¯´è¿‡è°è¢«å°¿æ†‹æ­»çš„ã€‚"
                                          </p>
                                        </div>
                                      </div>
                                      
                                      <div className="flex items-start gap-4 relative z-10">
                                        <AlertOctagon className="text-pop-red shrink-0 mt-1" size={28} />
                                        <div className="w-full">
                                          <p className="font-bold text-pop-red text-sm uppercase mb-2">Medical Facts</p>
                                          <ul className="text-lg font-medium space-y-3">
                                              <li className="flex items-start gap-2">
                                                  <span className="text-red-500">â€¢</span>
                                                  <span><strong className="text-black">å°¿è·¯æ„ŸæŸ“ (UTI):</strong> ç»†èŒåœ¨è†€èƒ±å†…ç¹æ®–ï¼Œå¼•å‘ç‚ç—‡ã€‚</span>
                                              </li>
                                              <li className="flex items-start gap-2">
                                                  <span className="text-red-500">â€¢</span>
                                                  <span><strong className="text-black">å°¿æ¶²å›æµ:</strong> å°¿æ¶²å€’æµå›è‚¾è„ï¼Œå¯èƒ½å¯¼è‡´<span className="bg-red-100 px-1">è‚¾ç›‚è‚¾ç‚</span>ã€‚</span>
                                              </li>
                                              <li className="flex items-start gap-2">
                                                  <span className="text-red-500">â€¢</span>
                                                  <span><strong className="text-black">æç«¯æƒ…å†µ:</strong> é•¿æœŸæ†‹å°¿å¯è¯±å‘è†€èƒ±ç ´è£‚ï¼Œå±åŠç”Ÿå‘½ï¼</span>
                                              </li>
                                          </ul>
                                        </div>
                                      </div>
                                      
                                      <div className="w-full h-24 relative mt-auto opacity-100 self-end pointer-events-none">
                                         <div className="absolute right-0 bottom-0 w-24 h-24"><SoftMascot expression="screaming"/></div>
                                      </div>
                                   </div>
                                   
                                   <div className="mt-6 font-pixel text-black text-2xl tracking-widest bg-pop-red/20 px-6 py-2 rounded border-2 border-black/10">DANGEROUS!</div>
                              </div>
                          </div>
                      </div>

                      {/* Poster 2: Myth - Pee disappears */}
                      <div className="relative group max-w-xl w-full mt-12 md:mt-0">
                          <div className="absolute -top-6 left-1/2 -translate-x-1/2 z-20 w-32 h-8 bg-white/50 -rotate-1 backdrop-blur-sm border-2 border-white/20 shadow-sm"></div>
                          <div className="absolute -top-8 left-1/2 -translate-x-1/2 z-30"><Pin className="text-pop-blue fill-pop-blue drop-shadow-md" size={40} /></div>
                          <div className="bg-white p-2 border-4 border-black shadow-hard-xl rotate-[2deg] group-hover:rotate-0 group-hover:scale-105 transition-all duration-300">
                              <div className="bg-pop-blue p-6 md:p-8 min-h-[500px] flex flex-col items-center text-center border-2 border-black relative overflow-hidden">
                                   <div className="absolute bottom-0 left-0 w-32 h-32 bg-white/20 rounded-full -ml-10 -mb-10 pointer-events-none"></div>

                                   {/* Badge */}
                                   <div className="absolute top-2 left-2 bg-black text-white text-sm font-bold px-3 py-1 -rotate-12 z-10">MYTH #02</div>
                                   
                                   <div className="bg-white rounded-full p-6 mb-4 shadow-hard border-4 border-black relative z-10">
                                     <Droplets size={64} className="text-pop-blue" strokeWidth={3} />
                                   </div>
                                   
                                   <h3 className="text-4xl font-black text-black mb-6 leading-tight bg-white px-4 py-2 -rotate-1 inline-block border-2 border-black shadow-sm">
                                     æ†‹ç€æ†‹ç€å°¿å°±æ²¡äº†?
                                   </h3>
                                   
                                   <div className="bg-white p-6 rounded-xl border-2 border-black w-full flex-1 flex flex-col gap-5 text-left shadow-soft relative">
                                      {/* Tape */}
                                      <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-20 h-5 bg-blue-200/80 -rotate-1 border border-blue-300/50"></div>

                                      <div className="flex items-start gap-4 border-b-2 border-dashed border-gray-200 pb-4">
                                        <XCircle className="text-gray-400 shrink-0 mt-1" size={24} />
                                        <div>
                                          <p className="font-bold text-gray-500 text-sm uppercase mb-1">Common Belief</p>
                                          <p className="text-gray-500 line-through decoration-2 decoration-red-500 font-medium text-xl">
                                            "æ†‹ä¸€ä¼šå„¿å°¿æ„å°±æ²¡äº†ï¼Œè‚¯å®šæ˜¯èº«ä½“å¸æ”¶äº†ã€‚"
                                          </p>
                                        </div>
                                      </div>
                                      
                                      <div className="flex items-start gap-4 relative z-10">
                                        <Activity className="text-pop-green shrink-0 mt-1" size={28} />
                                        <div className="w-full">
                                          <p className="font-bold text-pop-green text-sm uppercase mb-2">Consequences</p>
                                          <ul className="text-lg font-medium space-y-3">
                                              <li className="flex items-start gap-2">
                                                  <span className="text-green-500">â€¢</span>
                                                  <span><strong className="text-black">å°¿æ¶²æµ“ç¼©:</strong> æ°´åˆ†è¢«é‡å¸æ”¶ï¼Œä½†æ¯’ç´ å’Œç»†èŒç•™åœ¨è†€èƒ±é‡Œå¼€æ´¾å¯¹ã€‚</span>
                                              </li>
                                              <li className="flex items-start gap-2">
                                                  <span className="text-green-500">â€¢</span>
                                                  <span><strong className="text-black">è‚Œè‚‰æ¾å¼›:</strong> é€¼å°¿è‚Œé•¿æœŸæ‹‰ä¼¸å¤±å»å¼¹æ€§ï¼Œå¯¼è‡´<span className="bg-green-100 px-1">æ’å°¿å›°éš¾</span>ã€‚</span>
                                              </li>
                                              <li className="flex items-start gap-2">
                                                  <span className="text-green-500">â€¢</span>
                                                  <span><strong className="text-black">å‹åŠ›æ€§å°¿å¤±ç¦:</strong> å¤§ç¬‘æˆ–å’³å—½æ—¶å¯èƒ½ä¼šæ¼å°¿ï¼Œéå¸¸å°´å°¬ï¼</span>
                                              </li>
                                          </ul>
                                        </div>
                                      </div>

                                      <div className="w-full h-24 relative mt-auto opacity-100 self-end pointer-events-none">
                                         <div className="absolute right-0 bottom-0 w-24 h-24 transform rotate-6"><SoftMascot expression="worry"/></div>
                                      </div>
                                   </div>
                                   
                                   <div className="mt-6 font-pixel text-white text-2xl tracking-widest bg-black/20 px-6 py-2 rounded border-2 border-white/20">NOT MAGIC!</div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </section>
        );
      };

      // --- GameSection ---
      const GameSection = () => {
        const [gameState, setGameState] = useState(0); // 0: IDLE, 1: PLAYING, 2: WON
        const [currentLevelIdx, setCurrentLevelIdx] = useState(0);
        const [playerPos, setPlayerPos] = useState({ x: 0, y: 0 });
        const [urgency, setUrgency] = useState(0);
        const [timeLeft, setTimeLeft] = useState(0);
        const [showTip, setShowTip] = useState(false);
        const [message, setMessage] = useState("å‡†å¤‡å¥½äº†å—?");
        const [feedback, setFeedback] = useState(null);
        const gameLoopRef = useRef(null);

        const currentLevel = LEVELS[currentLevelIdx];

        const initLevel = useCallback((levelIndex) => {
          const level = LEVELS[levelIndex];
          let startX = 0, startY = 0;
          level.layout.forEach((row, y) => row.forEach((tile, x) => { if(tile === 'start') { startX = x; startY = y; } }));
          setPlayerPos({ x: startX, y: startY });
          setTimeLeft(level.timeLimit);
          setUrgency(0);
          setFeedback(null);
          setMessage(`Level ${levelIndex + 1}: ${level.name}`);
        }, []);

        const startGame = () => {
          setCurrentLevelIdx(0);
          initLevel(0);
          setGameState(1);
          setShowTip(false);
        };

        const nextLevel = () => {
          if (currentLevelIdx < LEVELS.length - 1) {
            setCurrentLevelIdx(prev => prev + 1);
            initLevel(currentLevelIdx + 1);
            setGameState(1);
            setShowTip(false);
          } else {
            setGameState(2);
            setMessage("å¤ªæ£’äº†ï¼ä½ æ˜¯ä¸€ä¸ªå¥åº·å°å«å£«ï¼");
            confetti({ particleCount: 300, spread: 180, colors: ['#FFEA00', '#FF4D8C', '#4DE1FF'] });
          }
        };

        const handleGameOver = (reason) => {
          setGameState(0);
          setMessage(reason); // Show the specific health warning directly
          if (gameLoopRef.current) clearInterval(gameLoopRef.current);
        };

        useEffect(() => {
          if (gameState === 1 && !showTip) {
            gameLoopRef.current = window.setInterval(() => {
              setTimeLeft(prev => {
                if (prev <= 0) { 
                  handleGameOver("è¶…æ—¶è­¦å‘Šï¼é•¿æ—¶é—´æ†‹å°¿ä¼šè®©è†€èƒ±è‚Œè‚‰å˜å¾—æ¾å¼›ï¼Œå°±åƒæ‹‰åçš„å¼¹ç°§ä¸€æ ·ï¼"); 
                  return 0; 
                }
                return prev - 1;
              });
              setUrgency(prev => {
                const increase = prev > 50 ? 6 : 4; 
                const newVal = prev + increase;
                if (newVal >= 100) { 
                  handleGameOver("ç³Ÿç³•ï¼æ†‹å°¿å¤±è´¥ï¼é•¿æœŸè¿™æ ·ä¼šå¯¼è‡´æ‹¬çº¦è‚ŒåŠŸèƒ½å—æŸï¼Œä»¥åå¯èƒ½æƒ³æ†‹éƒ½æ†‹ä¸ä½å“¦ï¼"); 
                  return 100; 
                }
                return newVal;
              });
              if (Math.random() > 0.8) setFeedback(null);
            }, 1000);
          }
          return () => { if (gameLoopRef.current) clearInterval(gameLoopRef.current); };
        }, [gameState, showTip]);

        const movePlayer = useCallback((dir) => {
          if (gameState !== 1 || showTip) return;
          
          setPlayerPos((prev) => {
              let newX = prev.x;
              let newY = prev.y;
              if (dir === 'up') newY--;
              if (dir === 'down') newY++;
              if (dir === 'left') newX--;
              if (dir === 'right') newX++;

              if (newX < 0 || newX >= currentLevel.gridSize || newY < 0 || newY >= currentLevel.gridSize) return prev;
              const targetTile = currentLevel.layout[newY][newX];

              if (targetTile === 'wall' || targetTile === 'coffee' || targetTile === 'tea') {
                  if (targetTile === 'coffee') { 
                      setFeedback("å’–å•¡è®©ä½ æ›´æƒ³å°¿å°¿ï¼+20%"); 
                      setUrgency(u => Math.min(u + 20, 99)); 
                  }
                  if (targetTile === 'tea') { 
                      setFeedback("å¥¶èŒ¶è™½ç„¶å¥½å–ï¼Œä½†ç°åœ¨ä¸è¡Œï¼+20%"); 
                      setUrgency(u => Math.min(u + 20, 99)); 
                  }
                  return prev; 
              }
              
              if (targetTile === 'dirty_toilet') { 
                  setFeedback("è„å•æ‰€åœ¨åº”æ€¥æ—¶ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©ï¼Œä½†è¦æ³¨æ„å«ç”Ÿå“Ÿ"); 
                  setUrgency(u => Math.min(u + 10, 99)); 
                  return { x: newX, y: newY }; 
              }
              if (targetTile === 'no_paper_toilet') { 
                  setFeedback("å“å‘€ï¼æ²¡æœ‰å•çº¸ï¼"); 
                  setUrgency(u => Math.min(u + 10, 99)); 
                  return { x: newX, y: newY }; 
              }

              setFeedback(null);
              if (targetTile === 'toilet') {
                if (gameLoopRef.current) clearInterval(gameLoopRef.current);
                setMessage("æ‰¾åˆ°äº†ï¼å¥½èˆ’æœï¼");
                setShowTip(true);
              }
              
              return { x: newX, y: newY };
          });
        }, [gameState, showTip, currentLevel, urgency]);

        useEffect(() => {
          const handleKeyDown = (e) => {
            if (e.key === 'ArrowUp') movePlayer('up');
            if (e.key === 'ArrowDown') movePlayer('down');
            if (e.key === 'ArrowLeft') movePlayer('left');
            if (e.key === 'ArrowRight') movePlayer('right');
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [movePlayer]);

        const renderTile = (tile, x, y) => {
            let content = null;
            let styleClass = "";
            switch (tile) {
                case 'wall': content = <span className="text-3xl filter drop-shadow-md">{currentLevel.wallIcon}</span>; break;
                case 'coffee': content = <span className="text-3xl filter drop-shadow-md">â˜•</span>; break;
                case 'tea': content = <span className="text-3xl filter drop-shadow-md">ğŸ§‹</span>; break;
                case 'toilet': content = <span className="text-3xl filter drop-shadow-md">ğŸš½</span>; styleClass = "bg-white/80 border-2 border-pop-blue shadow-inner"; break;
                case 'dirty_toilet': content = <span className="text-3xl filter drop-shadow-md relative">ğŸš½<span className="absolute -top-1 -right-1 text-xs">ğŸª°</span></span>; styleClass = "bg-gray-200 border-2 border-gray-400"; break;
                case 'no_paper_toilet': content = <span className="text-3xl filter drop-shadow-md relative">ğŸš½<span className="absolute -top-1 -right-1 text-xs">ğŸš«</span></span>; styleClass = "bg-gray-200 border-2 border-gray-400"; break;
            }
            return (
              <div key={`${x}-${y}`} className={`w-12 h-12 md:w-16 md:h-16 rounded-xl flex items-center justify-center relative transition-all duration-200 ${styleClass} ${tile === 'empty' || tile === 'start' ? 'bg-white/40' : ''}`}>
                  {content}
                  {playerPos.x === x && playerPos.y === y && (
                      <div className="absolute inset-0 z-10 transition-all duration-100 p-1"><SoftMascot expression={urgency > 70 ? 'worry' : 'happy'} /></div>
                  )}
              </div>
            );
        };

        return (
          <section id="game" className={`py-24 relative overflow-hidden bg-white/80 backdrop-blur-sm mx-4 md:mx-12 rounded-[40px] my-12 shadow-soft transition-all duration-100 ${urgency > 80 && gameState === 1 ? 'animate-shake' : ''}`}>
            <div className="container mx-auto px-4 relative z-10">
              <div className="text-center mb-6">
                <div className="inline-block bg-pop-pink text-white px-4 py-1 rounded-full font-bold mb-2">GAME ZONE</div>
                <h2 className="text-4xl md:text-6xl font-normal text-pop-pink mb-4">{gameState === 2 ? "é€šå…³å¤§æŒ‘æˆ˜" : "å¯»æ‰¾å•æ‰€å¤§å†’é™©"}</h2>
                <p className="text-xl text-gray-600 max-w-2xl mx-auto">{message}</p>
              </div>

              <div className="max-w-3xl mx-auto rounded-3xl p-6 border-4 border-white shadow-xl relative transition-all duration-500 flex flex-col items-center" style={gameState === 1 ? currentLevel.bgStyle : { backgroundColor: '#F3F4F6' }}>
                {gameState === 1 && (
                  <div className="w-full flex flex-col gap-2 mb-6 bg-white/90 p-4 rounded-xl border-2 border-gray-200 shadow-sm">
                    <div className="flex justify-between items-center">
                          <div className="flex-1 mr-4">
                              <div className="flex justify-between text-sm font-bold mb-1">
                                  <span>å°¿æ€¥åº¦ (Urgency)</span>
                                  <span className={`${urgency > 80 ? 'text-red-600 animate-pulse' : 'text-blue-500'}`}>{urgency}%</span>
                              </div>
                              <div className="h-4 bg-gray-200 rounded-full overflow-hidden border border-gray-300">
                                  <div className={`h-full transition-all duration-300 ${urgency > 70 ? 'bg-red-500' : urgency > 40 ? 'bg-yellow-500' : 'bg-green-500'}`} style={{ width: `${urgency}%` }}></div>
                              </div>
                          </div>
                          <div className="flex items-center gap-2 font-black text-xl text-pop-purple bg-purple-100 px-3 py-1 rounded-full"><Clock size={20} /><span>{timeLeft}s</span></div>
                    </div>
                    <div className="min-h-[2rem] flex items-center justify-center text-pop-red font-bold text-sm md:text-lg text-center leading-tight">
                        {feedback && <div className="flex items-center gap-2 animate-bounce"><AlertTriangle size={18} className="shrink-0" />{feedback}</div>}
                    </div>
                  </div>
                )}

                <div className="relative w-full flex flex-col items-center justify-center">
                  {gameState === 0 && (
                    <div className="text-center py-8">
                      <div className="w-40 h-40 mx-auto mb-6 animate-bounce"><SoftMascot expression="happy" /></div>
                      <button onClick={startGame} className="bg-pop-green hover:bg-green-400 text-white px-10 py-4 rounded-2xl text-2xl font-normal shadow-pixel hover:translate-y-1 transition-all flex items-center gap-2 mx-auto"><Play fill="white" size={24} /> å¼€å§‹å†’é™©</button>
                    </div>
                  )}
                  {gameState === 2 && (
                    <div className="text-center z-20 py-8">
                      <div className="w-40 h-40 mx-auto mb-6"><SoftMascot expression="happy" /></div>
                      <h3 className="text-3xl mb-6 font-normal">æ­å–œä½ ï¼å­¦ä¼šäº†å¥åº·æ’å°¿ä¹ æƒ¯ï¼</h3>
                      <button onClick={() => setGameState(0)} className="bg-pop-blue hover:bg-blue-400 text-white px-8 py-3 rounded-2xl text-xl font-normal shadow-pixel hover:translate-y-1 transition-all flex items-center gap-2 mx-auto"><RotateCcw /> å†ç©ä¸€æ¬¡</button>
                    </div>
                  )}
                  {gameState === 1 && !showTip && (
                    <div className="grid gap-2 md:gap-3" style={{ gridTemplateColumns: `repeat(${currentLevel.gridSize}, minmax(0, 1fr))` }}>
                      {currentLevel.layout.map((row, y) => row.map((tile, x) => renderTile(tile, x, y)))}
                    </div>
                  )}
                  
                  {gameState === 1 && !showTip && (
                    <div className="mt-8 flex flex-col items-center gap-3">
                        <button onClick={() => movePlayer('up')} className="w-16 h-16 bg-white rounded-2xl shadow-hard border-2 border-black active:bg-gray-100 active:translate-y-1 transition-all flex items-center justify-center"><ArrowUp size={32} strokeWidth={3} className="text-pop-blue"/></button>
                        <div className="flex gap-4">
                          <button onClick={() => movePlayer('left')} className="w-16 h-16 bg-white rounded-2xl shadow-hard border-2 border-black active:bg-gray-100 active:translate-y-1 transition-all flex items-center justify-center"><ArrowLeft size={32} strokeWidth={3} className="text-pop-blue"/></button>
                          <button onClick={() => movePlayer('down')} className="w-16 h-16 bg-white rounded-2xl shadow-hard border-2 border-black active:bg-gray-100 active:translate-y-1 transition-all flex items-center justify-center"><ArrowDown size={32} strokeWidth={3} className="text-pop-blue"/></button>
                          <button onClick={() => movePlayer('right')} className="w-16 h-16 bg-white rounded-2xl shadow-hard border-2 border-black active:bg-gray-100 active:translate-y-1 transition-all flex items-center justify-center"><ArrowRight size={32} strokeWidth={3} className="text-pop-blue"/></button>
                        </div>
                    </div>
                  )}

                  {showTip && (
                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center z-50 p-4 rounded-3xl">
                      <div className="bg-white rounded-3xl p-8 max-w-sm text-center border-4 border-pop-pink animate-float shadow-2xl">
                        <div className="w-24 h-24 mx-auto mb-4"><SoftMascot expression="relief" /></div>
                        <h3 className="text-2xl font-bold text-pop-pink mb-2">å¥åº·å°è´´å£«</h3>
                        <p className="text-lg mb-6">{currentLevel.tip}</p>
                        <button onClick={nextLevel} className="bg-pop-green text-white px-6 py-2 rounded-full font-bold shadow-hard hover:translate-y-1 text-xl">{currentLevelIdx < LEVELS.length - 1 ? "ä¸‹ä¸€å…³" : "é¢†å–å¥–åŠ±"}</button>
                      </div>
                    </div>
                  )}
                </div>
                {gameState === 1 && <div className="mt-6 text-center text-gray-500 text-sm font-bold bg-white/70 px-4 py-2 rounded-full">ğŸ’¡ ä½¿ç”¨å±å¹•æŒ‰é’®æˆ–é”®ç›˜æ–¹å‘é”®ç§»åŠ¨</div>}
              </div>
            </div>
          </section>
        );
      };

      // --- InfoSection ---
      const InfoSection = () => {
        const getIcon = (iconName) => {
          switch (iconName) {
            case 'AlertTriangle': return <AlertTriangle size={40} className="text-black" strokeWidth={3} />;
            case 'Droplets': return <Droplets size={40} className="text-black" strokeWidth={3} />;
            case 'Sparkles': return <Sparkles size={40} className="text-black" strokeWidth={3} />;
            default: return <Sparkles size={40} className="text-black" strokeWidth={3} />;
          }
        };

        return (
          <section id="info" className="py-24 bg-pop-pink border-t-4 border-black relative">
            <div className="container mx-auto px-4">
              <div className="mb-16 text-center"><h2 className="text-6xl md:text-8xl font-normal text-white drop-shadow-[6px_6px_0_#000000]">HABITS</h2></div>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12">
                {HEALTH_TIPS.map((tip, index) => (
                  <div key={tip.id} className="bg-white p-8 border-4 border-black shadow-hard group hover:bg-pop-yellow transition-colors rounded-2xl">
                    <div className="flex justify-between items-start mb-6">
                      <div className={`w-16 h-16 border-4 border-black flex items-center justify-center shadow-hard rounded-full ${index === 0 ? 'bg-pop-pink' : index === 1 ? 'bg-pop-blue' : 'bg-pop-green'}`}>{getIcon(tip.iconName)}</div>
                      <div className="font-pixel text-5xl text-gray-300 group-hover:text-black font-bold">0{index + 1}</div>
                    </div>
                    <h3 className="text-3xl font-normal mb-4 text-black">{tip.title}</h3>
                    <p className="text-xl text-gray-800 leading-relaxed border-t-4 border-black pt-4">{tip.description}</p>
                  </div>
                ))}
              </div>
            </div>
          </section>
        );
      };

      // --- Footer ---
      const Footer = () => {
        return (
          <footer className="bg-gray-900 text-white pt-16 pb-8 border-t-4 border-black">
            <div className="container mx-auto px-4">
              <div className="flex flex-col md:flex-row justify-between items-center mb-12 text-center md:text-left">
                <div className="mb-8 md:mb-0"><h3 className="text-3xl font-black text-pop-yellow mb-2">æ†‹å°¿OUTï¼Œè¢…è¢…ON</h3><p className="text-gray-400 max-w-sm">è®©æˆ‘ä»¬ä¸€èµ·å…³æ³¨å„¿ç«¥å¥åº·ï¼Œå…»æˆè‰¯å¥½çš„å¦‚å•ä¹ æƒ¯ï¼</p></div>
                <div className="flex gap-4">
                  <div className="w-12 h-12 bg-gray-800 rounded-lg hover:bg-pop-pink transition-colors cursor-pointer"></div>
                  <div className="w-12 h-12 bg-gray-800 rounded-lg hover:bg-pop-blue transition-colors cursor-pointer"></div>
                  <div className="w-12 h-12 bg-gray-800 rounded-lg hover:bg-pop-green transition-colors cursor-pointer"></div>
                </div>
              </div>
              <div className="border-t border-gray-800 pt-8 text-center text-gray-500 font-medium"><p>Â© 2024 æ†‹å°¿OUT campaign. All rights reserved.</p></div>
            </div>
          </footer>
        );
      };

      // --- App ---
      const App = () => {
        return (
          <div className="min-h-screen font-sans text-black selection:bg-black selection:text-pop-yellow overflow-x-hidden">
            <Navbar />
            <main>
              <Hero />
              <VideoSection />
              <PosterSection />
              <GameSection />
              <InfoSection />
            </main>
            <Footer />
          </div>
        );
      };

      // Mount the app
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
